 USE master
 IF EXISTS (SELECT * FROM SYS.DATABASES WHERE NAME = 'QUANLYPHONGKHAMNHAKHOA')
 DROP DATABASE QUANLYPHONGKHAMNHAKHOA
 GO
 CREATE DATABASE QUANLYPHONGKHAMNHAKHOA
 GO
USE QUANLYPHONGKHAMNHAKHOA

IF EXISTS (SELECT * FROM SYS.objects WHERE NAME = 'ACCOUNT')
	DROP TABLE ACCOUNT
GO
CREATE TABLE ACCOUNT(
    USERNAME CHAR(15) PRIMARY KEY,
    PASSWORD CHAR(15) NOT NULL,
    DISPLAYNAME NVARCHAR(30) NOT NULL,
    TYPE NVARCHAR(30) NOT NULL ,
)
IF EXISTS (SELECT * FROM SYS.objects WHERE NAME = 'BENHNHAN')
	DROP TABLE BENHNHAN
GO
CREATE TABLE BENHNHAN
(
    MABENHNHAN INT IDENTITY(1,1)  PRIMARY KEY,
    HOTEN NVARCHAR(30) NOT NULL,
    GIOITINH NCHAR(6) NOT NULL,
    NAMSINH DATE NOT NULL,
    SDT VARCHAR (15) NOT NULL,
    DIACHI NVARCHAR(50) NOT NULL,
    LYDOKHAM NVARCHAR(50) NOT NULL,
    NGAYDAUTIENDENKHAM DATE  DEFAULT GETDATE(),   
)
IF EXISTS (SELECT * FROM SYS.objects WHERE NAME = 'LAMSAN')
	DROP TABLE LAMSAN
GO 
CREATE TABLE LAMSAN(
    MABENHNHAN INT NOT NULL,
    MACHANDOAN CHAR(12) NOT NULL,
    MADIEUTRI CHAR(12) NOT NULL,
    NGAYDENKHAM DATE  DEFAULT GETDATE()
)
GO
IF EXISTS (SELECT * FROM SYS.objects WHERE NAME = 'DIEUTRI')
	DROP TABLE DIEUTRI
GO
CREATE TABLE DIEUTRI(
    MADIEUTRI CHAR(12)  PRIMARY KEY,
    TENDIEUTRI NVARCHAR(30) NOT NULL,
    DVT NVARCHAR(12),
    DONGIA FLOAT NOT NULL,
	MACHANDOAN CHAR(12) NOT NULL
)
GO
IF EXISTS (SELECT * FROM SYS.objects WHERE NAME = 'CHANDOAN')
	DROP TABLE CHANDOAN
GO 
CREATE TABLE CHANDOAN
(
    MACHANDOAN CHAR(12)  PRIMARY KEY,
    TENCHANDOAN NVARCHAR(30) NOT NULL,
)
GO 

IF EXISTS (SELECT * FROM SYS.objects WHERE NAME = 'NHANVIEN')
	DROP TABLE NHANVIEN
GO
CREATE TABLE NHANVIEN (
    MANV CHAR(12)  PRIMARY KEY,
    HOTEN NVARCHAR(30) NOT NULL,
    GIOITINH NCHAR(6) NOT NULL,
    CHUCVU NVARCHAR(8) NOT NULL,
    NAMSINH DATE NOT NULL,
    KINHNGHIEM NVARCHAR(20) NOT NULL,
    BANGCAP NVARCHAR(50) NOT NULL,
    SDT VARCHAR (15) NOT NULL,
    DIACHI NVARCHAR(50) NOT NULL,
)
GO
IF EXISTS (SELECT * FROM SYS.objects WHERE NAME = 'THUOC')
	DROP TABLE THUOC
GO
CREATE TABLE THUOC(
    MATHUOC CHAR(12)  PRIMARY KEY,
    TENTHUOC NVARCHAR(30) NOT NULL,
    SOLUONG INT NOT NULL,
    DVT NVARCHAR(50) NOT NULL,
    DONGIA FLOAT NOT NULL,
)
IF EXISTS (SELECT * FROM SYS.objects WHERE NAME = 'LICHSUNHAPLIEUTHUOC')
	DROP TABLE LICHSUNHAPLIEUTHUOC
GO
CREATE TABLE LICHSUNHAPLIEUTHUOC(
    STT INT IDENTITY(1,1)  PRIMARY KEY,
    LOAINHAPLIEU NVARCHAR(30),
    MATHUOC CHAR(12) NOT NULL,
    TENTHUOC NVARCHAR(30) NOT NULL,
    SOLUONG INT NOT NULL,
    DVT NVARCHAR(50) NOT NULL,
    DONGIA FLOAT NOT NULL,
    THOIGIAN DATETIME DEFAULT GETDATE(),
)
IF EXISTS (SELECT * FROM SYS.objects WHERE NAME = 'HOADON')
	DROP TABLE HOADON
GO 
CREATE TABLE HOADON (
    THOIGIA DATE,
    MAHOADON CHAR(12) PRIMARY KEY,
	MANV CHAR(12) NOT NULL,
    MABENHNHAN INT  NOT NULL,
    TONGTIEN FLOAT ,
    TRANGTHAI NVARCHAR(30) -- Đã thanh toán / Chưa thanh toán

)
IF EXISTS (SELECT * FROM SYS.objects WHERE NAME = 'CTHD')
	DROP TABLE CTHD
GO 
CREATE TABLE CTHD (
    MAHOADON CHAR(12) NOT NULL,   
    MADIEUTRI CHAR(12) NOT NULL,
    TENDIEUTRI NVARCHAR(30) NOT NULL,
    SOLUONG INT NOT NULL,
    THANHTIEN FLOAT NOT NULL,
)
IF EXISTS (SELECT * FROM SYS.objects WHERE NAME = 'VATLIEUDUNGCUNHAKHOA')
	DROP TABLE VATLIEUDUNGCUNHAKHOA
GO 
CREATE TABLE VATLIEUDUNGCUNHAKHOA (
    MADUNGCU CHAR(12) PRIMARY KEY,
    TENDUNGCU NVARCHAR(30) NOT NULL,
    SOLUONG INT NOT NULL,
    DVT NVARCHAR(30) NOT NULL,
    DONGIA FLOAT NOT NULL,
    

)
IF EXISTS (SELECT * FROM SYS.objects WHERE NAME = 'LICHSUNHAPLIEUVATTU')
	DROP TABLE LICHSUNHAPLIEUVATTU
GO 
CREATE TABLE LICHSUNHAPLIEUVATTU (
    STT INT IDENTITY(1,1)  PRIMARY KEY,
    LOAINHAPLIEU NVARCHAR(30),
    MADUNGCU CHAR(12) ,
    TENDUNGCU NVARCHAR(30) NOT NULL,
    SOLUONG INT NOT NULL,
    DVT NVARCHAR(30) NOT NULL,
    DONGIA FLOAT NOT NULL,
    THOIGIAN DATETIME DEFAULT GETDATE(),
)
IF EXISTS (SELECT * FROM SYS.objects WHERE NAME = 'PHIEUKHAMBENH')
	DROP TABLE PHIEUKHAMBENH
GO 
CREATE TABLE PHIEUKHAMBENH
(
    STT INT IDENTITY(1,1)  PRIMARY KEY,
    HOTEN NVARCHAR(30) NOT NULL,
    GIOITINH NCHAR(6) NOT NULL,
    NAMSINH DATE NOT NULL,
    SDT VARCHAR (15) NOT NULL,
    DIACHI NVARCHAR(50) NOT NULL,
    LYDOKHAM NVARCHAR(50) NOT NULL,
    NGAYDENKHAM DATE  DEFAULT GETDATE(),   
)
SET DATEFORMAT DMY
ALTER TABLE CTHD
	ADD CONSTRAINT PK_CTHD_HD_DT PRIMARY KEY (MAHOADON,MADIEUTRI)
ALTER TABLE LAMSAN
	ADD CONSTRAINT PK_LS_BN_CD_DT PRIMARY KEY (MABENHNHAN,MACHANDOAN,MADIEUTRI)
--TAO KHOA NGOAI 
ALTER TABLE DIEUTRI
	ADD CONSTRAINT FK_CD_DT FOREIGN KEY (MACHANDOAN) REFERENCES CHANDOAN(MACHANDOAN)  
ALTER TABLE LAMSAN
	ADD CONSTRAINT FK_LS_BN FOREIGN KEY (MABENHNHAN) REFERENCES BENHNHAN(MABENHNHAN),
	CONSTRAINT FK_LS_CD FOREIGN KEY (MACHANDOAN) REFERENCES CHANDOAN(MACHANDOAN),
	CONSTRAINT FK_LS_DT FOREIGN KEY (MADIEUTRI) REFERENCES DIEUTRI(MADIEUTRI)

ALTER TABLE HOADON
	ADD CONSTRAINT FK_HD_BN FOREIGN KEY (MABENHNHAN) REFERENCES BENHNHAN(MABENHNHAN),
	CONSTRAINT FK_HD_NV FOREIGN KEY (MANV) REFERENCES NHANVIEN(MANV) 
ALTER TABLE CTHD
	ADD CONSTRAINT FK_CTHD_DT FOREIGN KEY (MADIEUTRI) REFERENCES DIEUTRI(MADIEUTRI),
	CONSTRAINT FK_CTHD_HD FOREIGN KEY (MAHOADON) REFERENCES HOADON (MAHOADON)

	--TABLE ACCOUNT
	INSERT INTO ACCOUNT (USERNAME, PASSWORD, DISPLAYNAME, TYPE) VALUES
    ( 'admin','admin' ,  N'Lưu Quang Khánh' ,N'Quản trị viên' ),
	( 'nhasi','nhasi' ,  N'Nguyễn Đức Khánh' ,N'Nha sĩ' ),
	( 'letan','letan' ,  N'Trần Hoàng Nam' ,N'Lễ tân' )

	--TABLE BENHNHAN
	INSERT INTO BENHNHAN ( HOTEN, GIOITINH, NAMSINH, SDT, DIACHI, LYDOKHAM, NGAYDAUTIENDENKHAM) VALUES
    ( N'Trần Thị Chiêu', N'Nữ','22/03/2002', '038457895', N'Tân Bình', N'Đau răng' ,'9/9/2023'),
    ( N'Mai Thị Quế Anh', N'Nữ','19/08/1999', '039878987',N'Quận 9',   N'Gảy răng hàm' ,'9/9/2023'),
    ( N'Lê Văn Sáng', N'Nam','03/09/2019', '038457895',N'Quận 10', N'Răng lung lây' ,'10/9/2023'),
    ( N'Trần Hoàng', N'Nam','27/06/2003', '038457897',N'Quận 12', N'Răng ố vàng' ,'11/9/2023'),
    ( N'Lê Duy Luân', N'Nam','11/03/2000', '039786897',N'Bình Thạnh', N'Răng bị nhứt' ,'18/9/2023')

	--TABLE NHANVIEN
	INSERT INTO NHANVIEN ( MANV,HOTEN, GIOITINH, CHUCVU, NAMSINH, KINHNGHIEM, BANGCAP, SDT, DIACHI  ) VALUES
	( 'NV01',N'Lưu Quang Khánh', N'Nam ',N'Quản lý', '20/12/1990', N'9 Năm ' ,N'Bằng đại học Y dược Hà Nội','0394001232',N'195 Đường Lê Văn Việt Q.9 TP.HCM' ),	
    ( 'NV02',N'Nguyễn Đức Khánh', N'Nam ',N'Nha sĩ', '20/12/1992', N'7 Năm ' ,N'Bằng đại học Y dược TPHCM','0395657532',N'123 Đường Nguyễn Văn Tăng Q.9 TP.HCM' ),
	( 'NV03',N'Trần Hoàng Nam ', N'Nam ',N'Lễ Tân', '20/12/2000', N'3 Năm ' ,N'Bằng Cao đẳng y dược Nha Trang','0398585431',N'645/3/4 Lê Văn Việt Q.9 TP.HCM' ),
	( 'NV04',N'Đỗ Thanh Đào', N'Nam ',N'Bảo vệ', '20/12/1994', N'6 Năm ' ,N'Tốt nghiệp THPP','039872345',N'192/2 Đường Phạm Văn Đồng Q.9 TP.HCM' ),
	( 'NV05',N'Lê Duy Luân', N'Nam ',N'Tạp vụ', '20/12/2003', N'1 Năm ' ,N'Sinh viên năm 3 trường Hutech','0399823422',N'195/4/6 Đường Lê Văn Việt Q.9 TP.HCM' )
	--TABLE THUOC
	INSERT INTO THUOC ( MATHUOC,TENTHUOC, SOLUONG, DVT, DONGIA) VALUES	
	( 'T01',N'novocain'   ,30,N'1 lọ 300ml',  200000  ),
	( 'T02',N'lidocain'   ,20,N'1 lọ 300ml',  230000  ),
	( 'T03',N'xylocain'   ,20,N'1 lọ 300ml',  250000  ),
	( 'T04',N'paracetamol',200, N'Viên', 500  ),
	( 'T05',N'corticoid'  ,200, N'Viên', 300  ),
	( 'T06',N'amoxillin'  ,20, N'Viên', 200  ),
	( 'T07',N'cefixim'    ,0, N'Viên', 600  ),
	( 'T08',N'pilocarpin' ,180, N'Viên', 400  ),
	( 'T09',N'acyclovir'  ,181, N'Viên', 400  ),
	( 'T010',N'penciclovir',20, N'Viên', 550  )
	  --TABLE LICHSUNHAPLIEUTHUOC
    INSERT INTO LICHSUNHAPLIEUTHUOC ( LOAINHAPLIEU, MATHUOC, TENTHUOC, SOLUONG, DVT, DONGIA) VALUES
    ( N'Xuất thuốc', 'T01', N'novocain', 30, N'1 lọ 300ml',  20000 ),
    ( N'Nhập thuốc', 'T01', N'novocain', 30, N'1 lọ 300ml',  20000 )
    --TABLE CHANDOAN
    INSERT INTO CHANDOAN( MACHANDOAN,TENCHANDOAN) VALUES
    ( 'CD01', N'Cạo vôi răng'),
    ( 'CD02', N'Tẩy trắng răng'),
    ( 'CD03', N'Nhổ răng'),   
    ( 'CD04', N'Trám răng' ),
    ( 'CD05', N'Nội nha(Chữa tủy)'),
    ( 'CD06', N'Răng sứ'),
    ( 'CD07', N'Răng tháo lắp'),
    ( 'CD08', N'Niềng răng'),
    ( 'CD09', N'IMPLANT')
    --TABLE DIEUTRI
	INSERT INTO DIEUTRI( MADIEUTRI,TENDIEUTRI, DVT, DONGIA, MACHANDOAN ) VALUES
    ( 'DT01', N'Toàn hàm', N'Toàn hàm', 200000, 'CD01' ),
    ( 'DT02', N'Tại nhà', N'Toàn hàm', 400000, 'CD02' ),
    ( 'DT03', N'Tại phòng', N'Toàn hàm', 350000, 'CD02' ),
    ( 'DT04', N'Trước (1 chân)', N'Chiếc', 360000, 'CD03' ),
    ( 'DT05', N'Hàm (nhiều chân)', N'Chiếc', 370000, 'CD03' ),
    ( 'DT06', N'Khó', N'Chiếc', 330000, 'CD03' ),
    ( 'DT07', N'Chân răng', N'Chiếc', 320000, 'CD03' ),
    ( 'DT08', N'Sữa', N'Chiếc', 250000, 'CD03' ),
    ( 'DT09', N'Khôn hàm trên', N'Chiếc', 390000, 'CD03' ),
    ( 'DT11', N'Khôn hàm dưới', N'Chiếc', 370000, 'CD03' ),
    ( 'DT12', N'Sâu S1, S2', N'Chiếc', 170000, 'CD04' ),
    ( 'DT13', N'Sâu S3', N'Chiếc', 170000, 'CD04' ),
    ( 'DT14', N'Mòn cổ', N'Chiếc', 180000, 'CD04' ),
    ( 'DT15', N'Kẽ răng thưa', N'Kẽ', 200000, 'CD04' ),
    ( 'DT16', N'Đắp mặt', N'Chiếc', 200000, 'CD04' ),
    ( 'DT17', N'Gắn đá kim cương', N'Chiếc', 200000, 'CD04' ),
    ( 'DT18', N'Răng sữa (trẻ em)', N'Chiếc', 200000, 'CD05' ),
    ( 'DT19', N'Răng cửa', N'Chiếc', 200000, 'CD05' ),
    ( 'DT20', N'Răng tiền cối', N'Chiếc', 200000, 'CD05' ),
    ( 'DT21', N'Răng cối', N'Chiếc', 200000, 'CD05' ),
    ( 'DT22', N'Nội nha lại răng cửa', N'Chiếc', 200000, 'CD05' ),
    ( 'DT23', N'Nội nha lại răng tiền cối', N'Chiếc', 200000, 'CD05' ),
    ( 'DT24', N'Nội nha lại răng cối', N'Chiếc', 200000, 'CD05' ),
    ( 'DT25', N'Kim loại', N'Chiếc', 200000, 'CD06' ),
    ( 'DT26', N'Titan', N'Chiếc', 200000, 'CD06' ),
    ( 'DT27', N'Toàn sứ', N'Chiếc', 200000, 'CD06' ),
    ( 'DT28', N'Nền nhựa cứng bán hàm', N'Chiếc', 200000, 'CD07' ),
    ( 'DT29', N'Nền nhựa cứng toàn hàm', N'Chiếc', 200000, 'CD07' ),
    ( 'DT30', N'Nền nhựa mềm bán hàm', N'Chiếc', 200000, 'CD07' ),
    ( 'DT31', N'Nền nhựa mềm toàn hàm', N'Chiếc', 200000, 'CD07' ),
    ( 'DT32', N'Răng nhựa Việt Nam', N'Chiếc', 200000, 'CD07' ),
    ( 'DT33', N'Răng nhựa Ngoại', N'Chiếc', 200000, 'CD07' ),
    ( 'DT34', N'Răng composite', N'Chiếc', 200000, 'CD07' ),
    ( 'DT35', N'Răng sứ', N'Chiếc', 200000, 'CD07' ),
    ( 'DT36', N'Hàm khung kim loại', N'Chiếc', 200000, 'CD07' ),
    ( 'DT37', N'Hàm khung liên kết', N'Chiếc', 200000, 'CD07' ),
    ( 'DT38', N'Hàm khung nhựa cứng', N'Chiếc', 200000, 'CD07' ),
    ( 'DT39', N'Hàm khung nhựa mềm', N'Chiếc', 200000, 'CD07' ),
    ( 'DT40', N'Mắc cài kim loại', N'Chiếc', 200000, 'CD08' ),
    ( 'DT41', N'Mắc cài sứ', N'Chiếc', 200000, 'CD08' ),
    ( 'DT42', N'Hàn Quốc', N'Chiếc', 200000, 'CD09' ),
    ( 'DT43', N'Ý', N'Chiếc', 200000, 'CD09' ),
    ( 'DT44', N'Mỹ', N'Chiếc', 200000, 'CD09' ),
    ( 'DT45', N'Khác', N'Chiếc', 200000, 'CD09' )

    
    --TABLE LAMSAN
    INSERT INTO LAMSAN (MABENHNHAN, MACHANDOAN, MADIEUTRI, NGAYDENKHAM) VALUES
    (1, 'CD05', 'DT22', '12/09/2023'),
    (1, 'CD07', 'DT39', '12/09/2023'),
    (2, 'CD04', 'DT16', '24/09/2023'),
    (3, 'CD03', 'DT05', '28/09/2023'),
    (3, 'CD09', 'DT44', '01/10/2023'),
    (4, 'CD01', 'DT01', '03/10/2023'),
    (4, 'CD06', 'DT27', '03/10/2023'),
    (5, 'CD02', 'DT03', '09/10/2023')
	--TABLE HOADON
	INSERT INTO HOADON( THOIGIA, MAHOADON, MANV, MABENHNHAN,TONGTIEN, TRANGTHAI ) VALUES
	( GETDATE(), 'HD01', 'NV03',1, 490000, N'Chưa thanh toán' ),
    ( GETDATE(), 'HD02', 'NV03',2, 3000000, N'Chưa thanh toán' ),
    ( GETDATE(), 'HD03', 'NV03',3, 150000, N'Chưa thanh toán' ),
    ( GETDATE(), 'HD04', 'NV03',4, 32200000, N'Chưa thanh toán' )
    --TABLE CTHD
	INSERT INTO CTHD( MAHOADON, MADIEUTRI,TENDIEUTRI, SOLUONG, THANHTIEN ) VALUES
	( 'HD01', 'DT01', N'Cạo vôi răng', 1, 200000),
    ( 'HD01', 'DT02', N'Tẩy trắng răng', 1, 200000),
    ( 'HD01', 'DT04', N'Trám răng', 3, 90000),
    ( 'HD02', 'DT09', N'IMPLANT', 3, 3000000),
    ( 'HD03', 'DT03', N'Nhỗ răng', 1, 50000),
    ( 'HD03', 'DT07', N'RĂNG THÁO LẮP', 1, 100000),
    ( 'HD04', 'DT01', N'Cạo vôi răng', 3, 200000),
    ( 'HD04', 'DT08', N'NIỀNG RĂNG', 3, 30000000)
 
--TABLE PHIEUKHAMBENH
	INSERT INTO PHIEUKHAMBENH ( HOTEN, GIOITINH, NAMSINH, SDT, DIACHI, LYDOKHAM) VALUES
    ( N'Trần Thị Minh', N'Nữ','22/03/2002', '039599955', N'Tân Bình', N'Đau răng' )
--TABLE VATLIEUDUNGCUNHAKHOA
    INSERT INTO VATLIEUDUNGCUNHAKHOA (  MADUNGCU, TENDUNGCU, SOLUONG, DVT, DONGIA) VALUES
    ('VT01', N'Kiêm tiêm' , 50, N'1 Ống',  5000 ),
    ('VT02', N'Khoan nha khoa' , 5, N'1 Khoan',  5000 )
--TABLE LICHSUNHAPLIEUVATTU
    INSERT INTO LICHSUNHAPLIEUVATTU ( LOAINHAPLIEU, MADUNGCU, TENDUNGCU, SOLUONG, DVT, DONGIA) VALUES
    ( N'Xuất vật tư', 'VT01', N'Kiêm tiêm' , 30, N'1 Ống',  5000 ),
    ( N'Nhập vật tư', 'VT02', N'Khoan nha khoa' , 30, N'1 Khoan',  5000 )
 
SELECT * FROM LICHSUNHAPLIEUTHUOC
SELECT * FROM LICHSUNHAPLIEUVATTU
SELECT * FROM CHANDOAN
SELECT * FROM DIEUTRI
SELECT * FROM HOADON
SELECT * from CTHD